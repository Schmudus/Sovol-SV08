[include machine.cfg]
[include mainsail.cfg]
[include macro.cfg]
[include shaketune.cfg]
[include stepper.cfg]
[include tmc.cfg]
[include TEST_SPEED.cfg]
[include timelapse.cfg]
[include fan.cfg]
[include neopixel.cfg]
[include autotune.cfg]
[skew_correction]
[exclude_object]
[force_move]
enable_force_move: True
[save_variables]
filename: ~/printer_data/config/variables.cfg
[gcode_arcs]                       
resolution: 0.1 #1.0
[idle_timeout]
gcode: _IDLE_TIMEOUT
timeout: 108000
[virtual_sdcard]
path: ~/printer_data/gcodes
on_error_gcode: CANCEL_PRINT


#############################################################################
###			ADXL
#############################################################################

[resonance_tester]
accel_chip: adxl345
probe_points:
    175, 175, 30
accel_per_hz:50
min_freq:1
max_freq:100
max_smoothing:0.2
hz_per_sec:0.5

[input_shaper]
#  Y = Best shaper: MZV @ 41.6 Hz (with a damping ratio of 0.057)
#  X = Best shaper: MZV @ 56.8 Hz (with a damping ratio of 0.062)

shaper_type_y: mzv              # mzv
shaper_freq_y: 41.6             # 46.2
damping_ratio_y: 0.057          # 0.042
shaper_type_x: mzv              # mzv
shaper_freq_x: 56.8             # 60.4
damping_ratio_x: 0.062          # 0.053

#############################################################################
###			TEMPERATURES
#############################################################################

[thermistor thermistor_extruder]
temperature1:25
resistance1:110000
temperature2:100
resistance2:7008
temperature3:220
resistance3:435

[thermistor thermistor_bed]
temperature1:25
resistance1:100000
temperature2:50
resistance2:18085.4
temperature3:100
resistance3:5362.6

[temperature_sensor btt_eddy_mcu]
sensor_type: temperature_mcu
sensor_mcu: eddy
min_temp: 10
max_temp: 100

[temperature_probe btt_eddy]
sensor_type: Generic 3950
sensor_pin: eddy:gpio26
horizontal_move_z: 2

#############################################################################
###			HEATERS
#############################################################################

[heater_bed]
heater_pin:PA1
sensor_type: thermistor_bed
sensor_pin: PF3
max_power: 0.90
min_temp: 5
max_temp: 105
pwm_cycle_time: 0.3
#control: pid
#pid_kp: 66.381
#pid_ki: 1.203
#pid_kd: 916.057

[verify_heater heater_bed]      
max_error: 120                
check_gain_time:40           
hysteresis: 5                
heating_gain: 2

[verify_heater extruder]      
max_error: 200
check_gain_time:30
hysteresis: 10
heating_gain: 2

#############################################################################
###			PRINTER
#############################################################################

[printer]
kinematics: corexy           
max_velocity: 600 #700            
max_accel: 30000 #40000        
minimum_cruise_ratio: 0.33
max_z_velocity: 26 #25 #20
max_z_accel: 500             
square_corner_velocity: 5.0  

#############################################################################
###			PROBE
#############################################################################

[probe_eddy_current btt_eddy]
sensor_type: ldc1612
i2c_mcu: eddy
i2c_bus: i2c0f
x_offset: -17
y_offset: 10
z_offset: 1.5
speed: 3.0
lift_speed: 20

#############################################################################
###			MESH, LEVEL, Calibrate
#############################################################################

[bed_mesh]
speed: 200
horizontal_move_z: 2
mesh_min: 20,25
mesh_max: 333,325
probe_count: 20,20
algorithm: bicubic
bicubic_tension: 0.2 #0.3
fade_start: 0.4 #0
fade_end: 10
fade_target: 0

# For the mesh dimensions below, the coordinates need to be reachable by the center of the probe. To calculate coordinates that will work, use the formula below:
# mesh x min = position_min_x + greater_of (15mm or x_offset) <--- in this term, only consider the x offset if it is positive, ignore if negative.
# mesh y min = position_min_y + greater_of (15mm or y_offset) <--- in this term, only consider the y offset if it is positive, ignore if negative.
# mesh x max = position_max_x - greater_of (15mm or |x_offset|) <--- in this term, only consider the x offset if it is negative, ignore if positive.
# mesh y max = position_max_y - greater_of (15mm or |y_offset|) <--- in this term, only consider the y offset if it is negative, ignore if positive.
# Example: Consider that you have a 300 x 300 bed with the max x and y positions being 300 and the min being 0. Your probe offsets are -20 for X and 10 for Y
# For mesh x min we ignore the x offset term because it is negative. Therefore mesh x min = 15
# For mesh y min we do not ignore the y offset term because it is positive but it is less than 15 so we use 15. Therefore mesh y min = 15
# For mesh x max we do not ignore the x offset term because it is negative. It is also greater than 15. Therefore mesh x max = 280
# For mesh y max we ignore the y offset term because it is positive but it is less than 15 so we use 15. Therefore mesh y max = 285
# The final result would be mesh_min: 15, 15 mesh_max: 280, 285

[quad_gantry_level]          
gantry_corners:              
	-60,-10
	410,420
points:
	36,10
	36,320
	346,320
	346,10
speed: 500        
horizontal_move_z: 5
retry_tolerance: 0.0075
retries: 7
max_adjust: 10  

#############################################################################
###			EXTRUDER
#############################################################################
[extruder]
step_pin: extra_mcu:PA8   
dir_pin: extra_mcu:PB8    
enable_pin:!extra_mcu: PB11   
rotation_distance: 6.745 #6.5 
microsteps: 128 #16                
full_steps_per_rotation: 200 
nozzle_diameter: 0.400        
filament_diameter: 1.75  
max_extrude_only_distance: 200.0
max_extrude_cross_section: 45.0
heater_pin: extra_mcu:PB9  
sensor_type: thermistor_extruder  
pullup_resistor: 11500
sensor_pin: extra_mcu:PA5  
min_temp: 5                  
max_temp: 308        
max_power: 0.95
min_extrude_temp: 185
#control: pid
#pid_kp: 22.410
#pid_ki: 2.298
#pid_kd: 54.624
pressure_advance: 0.025       
pressure_advance_smooth_time: 0.020

[filament_switch_sensor filament_sensor]
pause_on_runout: True
event_delay: 3.0
pause_delay: 5
switch_pin: ^!PG14
runout_gcode: RUNOUT

#############################################################################
###			LED
#############################################################################

[led main_led]
white_pin: PD12
cycle_time: 0.01 #5
initial_WHITE: 0.15

#############################################################################
###			PINS
#############################################################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PC5

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.049956:3167379.212,0.090107:3166807.938,0.130025:3166291.192,
#*# 	0.169942:3165759.577,0.210094:3165247.593,0.250012:3164740.812,
#*# 	0.289929:3164244.504,0.330081:3163762.320,0.369998:3163302.278,
#*# 	0.409916:3162857.797,0.450067:3162387.114,0.489985:3161925.269,
#*# 	0.529903:3161494.520,0.570054:3161050.124,0.609972:3160617.786,
#*# 	0.649890:3160216.282,0.690041:3159762.975,0.729959:3159396.884,
#*# 	0.770110:3158984.258,0.810028:3158625.266,0.849946:3158224.686,
#*# 	0.890097:3157838.620,0.930015:3157480.876,0.969933:3157109.767,
#*# 	1.010084:3156773.023,1.050002:3156399.027,1.089920:3156055.704,
#*# 	1.130071:3155703.242,1.169989:3155378.193,1.209907:3155043.349,
#*# 	1.250058:3154731.043,1.289976:3154423.417,1.329893:3154100.198,
#*# 	1.370045:3153800.089,1.409962:3153506.902,1.450114:3153184.321,
#*# 	1.490032:3152908.341,1.529949:3152612.876,1.570101:3152368.367,
#*# 	1.610018:3152079.686,1.649936:3151799.766,1.690087:3151535.874,
#*# 	1.730005:3151267.579,1.769923:3151018.079,1.810074:3150772.837,
#*# 	1.849992:3150521.492,1.889910:3150287.490,1.930061:3150032.096,
#*# 	1.969979:3149807.852,2.009897:3149568.090,2.050048:3149350.417,
#*# 	2.089966:3149124.001,2.129884:3148895.208,2.170035:3148681.356,
#*# 	2.209953:3148480.352,2.250104:3148269.054,2.290022:3148049.757,
#*# 	2.329940:3147857.435,2.370091:3147661.902,2.410009:3147451.572,
#*# 	2.449927:3147260.108,2.490078:3147085.438,2.529996:3146883.626,
#*# 	2.569913:3146693.341,2.610065:3146517.145,2.649983:3146330.597,
#*# 	2.689900:3146166.837,2.730052:3145979.735,2.769969:3145813.398,
#*# 	2.809887:3145618.549,2.850038:3145459.170,2.889956:3145311.515,
#*# 	2.930108:3145150.605,2.970025:3144982.025,3.009943:3144845.409,
#*# 	3.050094:3144663.037,3.090012:3144522.834,3.129930:3144381.827,
#*# 	3.170081:3144224.468,3.209999:3144093.204,3.249917:3143946.096,
#*# 	3.290068:3143787.257,3.329986:3143656.293,3.369904:3143517.823,
#*# 	3.410055:3143382.688,3.449973:3143230.595,3.489891:3143097.806,
#*# 	3.530042:3142975.904,3.569960:3142856.920,3.610111:3142729.254,
#*# 	3.650029:3142608.644,3.689947:3142461.369,3.730098:3142351.499,
#*# 	3.770016:3142237.258,3.809933:3142128.408,3.850085:3141998.713,
#*# 	3.890003:3141893.159,3.929920:3141807.296,3.970072:3141680.097,
#*# 	4.009989:3141565.431,4.049907:3141438.589
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 43.543895
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.246917, 0.214101, 0.183895, 0.147815, 0.120105, 0.092206, 0.088191, 0.077184, 0.063132, 0.049316, 0.028708, 0.030773, 0.015220, 0.024215, 0.028775, 0.050076, 0.086357, 0.138162, 0.194162, 0.240929
#*# 	  0.237791, 0.193055, 0.162211, 0.134097, 0.113018, 0.102867, 0.095529, 0.070538, 0.075350, 0.062037, 0.053107, 0.041565, 0.026410, 0.027410, 0.022912, 0.030266, 0.056898, 0.095874, 0.147611, 0.175119
#*# 	  0.207796, 0.188540, 0.155058, 0.135432, 0.117538, 0.121523, 0.126925, 0.111129, 0.109859, 0.091860, 0.073516, 0.078709, 0.062295, 0.033635, 0.034314, 0.036954, 0.046029, 0.079019, 0.117271, 0.129577
#*# 	  0.197995, 0.160959, 0.121790, 0.106881, 0.117004, 0.118154, 0.108370, 0.097709, 0.098852, 0.084522, 0.070192, 0.055802, 0.043585, 0.041982, 0.040044, 0.037264, 0.034566, 0.036840, 0.059341, 0.066338
#*# 	  0.152255, 0.129310, 0.117271, 0.113018, 0.122673, 0.111601, 0.113018, 0.110184, 0.092321, 0.102521, 0.084522, 0.077184, 0.058305, 0.045439, 0.042570, 0.031615, 0.014649, 0.029308, 0.042570, 0.048727
#*# 	  0.144635, 0.117271, 0.099198, 0.099198, 0.099543, 0.106536, 0.103212, 0.104701, 0.103629, 0.090371, 0.084522, 0.067435, 0.059767, 0.042236, 0.041982, 0.040551, 0.031868, 0.024509, 0.044344, 0.027113
#*# 	  0.099198, 0.111334, 0.093694, 0.099198, 0.111334, 0.111334, 0.099543, 0.119304, 0.095874, 0.086702, 0.077530, 0.080508, 0.058754, 0.052014, 0.049060, 0.034059, 0.034566, 0.028376, 0.026410, 0.014619
#*# 	  0.063132, 0.059847, 0.054453, 0.060434, 0.077184, 0.067433, 0.063642, 0.068784, 0.062547, 0.068274, 0.060101, 0.046872, 0.030855, 0.030773, 0.022912, 0.018120, -0.000775, -0.004275, -0.020748, -0.043070
#*# 	  0.000825, 0.022914, 0.034566, 0.038695, 0.047378, 0.044852, 0.053107, 0.055551, 0.037854, 0.037428, 0.038107, 0.027709, -0.002073, 0.008221, 0.005021, -0.014929, -0.013690, -0.026279, -0.028664, -0.048981
#*# 	  0.021913, 0.030773, 0.029177, 0.043920, 0.055551, 0.053363, 0.054712, 0.057153, 0.059598, 0.047967, 0.044258, 0.040044, 0.016817, 0.016520, 0.026246, 0.017818, 0.002123, 0.003422, 0.010817, -0.017029
#*# 	  0.018115, 0.050665, 0.055805, 0.061196, 0.071681, 0.066084, 0.082342, 0.076839, 0.085666, 0.070195, 0.071681, 0.064481, 0.044091, 0.047711, 0.043920, 0.036758, 0.031950, 0.023211, 0.047548, 0.034648
#*# 	  0.034370, 0.048727, 0.055802, 0.064737, 0.077184, 0.084177, 0.064993, 0.077184, 0.087500, 0.086011, 0.093349, 0.073516, 0.059593, 0.046872, 0.059598, 0.053363, 0.046788, 0.033553, 0.046362, 0.051758
#*# 	  0.019848, 0.051115, 0.060688, 0.078673, 0.070195, 0.079019, 0.082688, 0.068784, 0.067435, 0.084522, 0.084522, 0.077187, 0.059593, 0.053109, 0.062293, 0.053105, 0.048727, 0.047376, 0.060944, 0.093694
#*# 	  0.036169, 0.044680, 0.046283, 0.053359, 0.066086, 0.063642, 0.073516, 0.068782, 0.074659, 0.075004, 0.077184, 0.071681, 0.059847, 0.046283, 0.050411, 0.055805, 0.039286, 0.045523, 0.067179, 0.114169
#*# 	  0.032964, 0.050917, 0.059762, 0.058246, 0.068784, 0.075350, 0.077184, 0.073516, 0.068782, 0.075696, 0.089414, 0.084522, 0.076839, 0.077530, 0.068078, 0.069036, 0.069623, 0.062039, 0.104090, 0.172660
#*# 	  0.053103, 0.038949, 0.043920, 0.046618, 0.058504, 0.053109, 0.053363, 0.058504, 0.050076, 0.050919, 0.065832, 0.067179, 0.062293, 0.041730, 0.056059, 0.059593, 0.056898, 0.049566, 0.112662, 0.167251
#*# 	  0.055803, 0.049820, 0.044009, 0.043135, 0.047376, 0.048139, 0.051758, 0.045718, 0.034730, 0.054202, 0.058246, 0.057966, 0.048727, 0.049316, 0.055805, 0.060692, 0.059849, 0.073170, 0.123209, 0.198252
#*# 	  0.136048, 0.062547, 0.051932, 0.048645, 0.049316, 0.055805, 0.049316, 0.054456, 0.044934, 0.056900, 0.062293, 0.057153, 0.053363, 0.054712, 0.060434, 0.075350, 0.076839, 0.098507, 0.145249, 0.212993
#*# 	  0.153803, 0.112751, 0.068782, 0.053359, 0.060942, 0.054961, 0.063132, 0.057153, 0.054712, 0.060688, 0.062291, 0.070538, 0.058500, 0.065576, 0.068784, 0.079021, 0.093694, 0.120105, 0.180799, 0.250324
#*# 	  0.248175, 0.185443, 0.131794, 0.100687, 0.081199, 0.084522, 0.084177, 0.076839, 0.067433, 0.071681, 0.089334, 0.077184, 0.077184, 0.086011, 0.093694, 0.094040, 0.113018, 0.137279, 0.205069, 0.262189
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 332.92999999999995
#*# min_y = 25.0
#*# max_y = 324.8199999999999
#*#
#*# [skew_correction calilantern_skew_profile]
#*# xy_skew = -0.0006010428404623171
#*# xz_skew = -0.0021001165151680544
#*# yz_skew = 0.0007000434360676134
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 25.306
#*# pid_ki = 3.276
#*# pid_kd = 48.872
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 89.042
#*# pid_ki = 7.511
#*# pid_kd = 90.888
